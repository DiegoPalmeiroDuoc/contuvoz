<!DOCTYPE html>
<html lang="es">
<head>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#34d399">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🔤 Vocales - Dinámico</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Comic Sans MS', cursive, sans-serif; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-green-100 via-green-200 to-green-100 flex items-center justify-center p-6 text-gray-800">
  <section class="bg-white rounded-3xl shadow-2xl p-10 max-w-xl w-full text-center border-4 border-green-300">
    <h2 class="text-4xl font-bold text-green-700 mb-6">🔤 Di una vocal</h2>

    <img id="imgVocal" src="img/a_sound.png"
      alt="Imagen de vocal"
      class="w-48 h-48 mx-auto mb-6 object-contain rounded-2xl border-4 border-green-300" />

    <p class="text-xl font-semibold mb-4">
      Vocal detectada: <strong id="vocalTexto" class="text-green-800 underline decoration-wavy">A</strong>
    </p>

    <div id="volumenContainer" class="mb-6">
      <div class="w-full h-6 rounded-lg bg-green-200 relative overflow-hidden">
        <div id="barraVolumen" class="h-full bg-green-500 w-0 transition-all duration-200 ease-in-out"></div>
      </div>
      <div id="indicadorVolumen" class="mt-2 text-green-600 text-lg font-medium">🔈 Esperando voz...</div>
    </div>

    <button id="startRecognition"
      class="bg-green-500 hover:bg-green-600 text-white font-bold text-xl py-3 px-6 rounded-xl shadow-lg transition mb-6">
      🎙️ Escuchar
    </button>

    <p id="resultado" class="text-lg text-gray-700 mb-6 min-h-[2rem]"></p>

    <a href="../speechToText/hablemos.html"
      class="inline-block bg-yellow-400 hover:bg-yellow-500 text-white font-bold text-lg px-6 py-2 rounded-xl shadow">
      ⬅ Volver
    </a>
  </section>

<script>
const vocalTexto = document.getElementById("vocalTexto");
const imgVocal = document.getElementById("imgVocal");
const barraVolumen = document.getElementById("barraVolumen");
const indicadorVolumen = document.getElementById("indicadorVolumen");
const resultado = document.getElementById("resultado");
const startBtn = document.getElementById("startRecognition");

let recognition;

if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.lang = "es-ES";
  recognition.continuous = false;
  recognition.interimResults = false;
} else {
  alert("Lo siento, tu navegador no soporta SpeechRecognition.");
}

startBtn.addEventListener("click", () => {
  if (recognition) {
    recognition.start();
    resultado.textContent = "🎤 Escuchando...";
    startBtn.classList.add("bg-green-700", "animate-pulse");
    indicadorVolumen.textContent = "🎤 Escuchando...";
    animateVolumen();
  }
});

if (recognition) {
 recognition.onresult = (event) => {
  const transcript = event.results[0][0].transcript.trim().toUpperCase();
  resultado.textContent = `Has dicho: ${transcript}`;

  if (["A","E","I","O","U"].includes(transcript)) {
    // Es una vocal aislada
    vocalTexto.textContent = transcript;
    imgVocal.src = `img/${transcript.toLowerCase()}_sound.png`;
  } else {
    // Buscar vocal más repetida dentro del texto
    const counts = {A:0, E:0, I:0, O:0, U:0};
    for (const c of transcript) {
      if (counts.hasOwnProperty(c)) counts[c]++;
    }
    const mostCommon = Object.keys(counts).reduce((a,b)=> counts[a]>counts[b]?a:b);
    
    if (counts[mostCommon] > 0) {
      vocalTexto.textContent = mostCommon;
      imgVocal.src = `img/${mostCommon.toLowerCase()}_sound.png`;
    } else {
      vocalTexto.textContent = "-";
      imgVocal.src = "img/a_sound.png";
    }

    resultado.textContent += " | No fue una vocal aislada.";
  }
};


  recognition.onend = () => {
    resultado.textContent += " | 🎙️ Fin.";
    startBtn.classList.remove("bg-green-700", "animate-pulse");
    indicadorVolumen.textContent = "🔈 Esperando voz...";
    barraVolumen.style.width = "0%";
  };

  recognition.onerror = (event) => {
    resultado.textContent = "Error: " + event.error;
    startBtn.classList.remove("bg-green-700", "animate-pulse");
    indicadorVolumen.textContent = "❌ Error de reconocimiento.";
    barraVolumen.style.width = "0%";
  };
}

// animación "falsa" de volumen
function animateVolumen() {
  let i = 0;
  const interval = setInterval(() => {
    if (!startBtn.classList.contains("animate-pulse")) {
      clearInterval(interval);
      barraVolumen.style.width = "0%";
      return;
    }
    const fakeVol = 30 + Math.abs(Math.sin(i/10) * 70);
    barraVolumen.style.width = `${fakeVol}%`;
    if (fakeVol < 30) {
      barraVolumen.className = "h-full bg-green-500";
    } else if (fakeVol < 70) {
      barraVolumen.className = "h-full bg-yellow-400";
    } else {
      barraVolumen.className = "h-full bg-red-500";
    }
    i++;
  }, 100);
}
</script>
</body>
</html>
